<html>
<title>
    simple webrtc demo
</title>

<body>
    本端path:
    <input type="text" id="local-path" value="" size="20"> 对端path:
    <input type="text" id="remote-path" value="" size="20">
    <button id="confirm">confirm</button>
    <button id="add">addStream</button>
    <button id="remove">removeStream</button>
    <div>
        <video id="self-view" autoplay muted></video>
    </div>
    <div>
        <video id="remote-view" autoplay muted></video>
    </div>
    <script src="https://cdn.wilddog.com/sdk/js/current/wilddog.js"></script>
    <script src="../wild-peerconnection.js"></script>
    <script>
        var localPathInput = document.getElementById("local-path");
        var remotePathInput = document.getElementById("remote-path");
        var localView = document.getElementById("self-view");
        var remoteView = document.getElementById("remote-view");
        var confirmBtn = document.getElementById("confirm")
        var addBtn = document.getElementById("add");
        var removeBtn = document.getElementById("remove");
        var ref = new Wilddog("https://test123.wilddogio.com/");
        var localRef = null;
        var remoteRef = null;
        var wildPeer = null;
        var currentStream = null;
        confirmBtn.onclick = function(){
           var lp = localPathInput.value;
           if(lp.length>0){
               localRef = ref.child(lp);
           }
           var rp = remotePathInput.value;
           if(rp.length>0){
               remoteRef = ref.child(rp);
           }
           wildPeer = new WildPeerConnection(localRef,remoteRef);
           wildPeer.on('addstream',function(stream){
               remoteView.src = URL.createObjectURL(stream);
           }) 
            
        }
        addBtn.onclick = function(){
            navigator.getUserMedia({"video": true},function(stream){
                console.log("addStream");
                currentStream = stream;
                wildPeer.addStream(stream);     
            },function(err){
                console.log(err)
            }); 
        }
        removeBtn.onclick = function(){
            if(currentStream == null){
                return;
            }
            wildPeer.removeStream(currentStream);
        }
    </script>
</body>


</html>